/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * json-patch-duplex.js version: 0.5.7
 * (c) 2013 Joachim Wester
 * MIT license
 */
var __extends=this&&this.__extends||function(a,b){function d(){this.constructor=a}for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);a.prototype=null===b?Object.create(b):(d.prototype=b.prototype,new d)},OriginalError=Error,jsonpatch;!function(a){function c(a,d){switch(typeof a){case"undefined":case"boolean":case"string":case"number":return a===d;case"object":if(null===a)return null===d;if(v(a)){if(!v(d)||a.length!==d.length)return!1;for(var e=0,f=a.length;e<f;e++)if(!c(a[e],d[e]))return!1;return!0}var g=b(d),h=g.length;if(b(a).length!==h)return!1;for(var e=0;e<h;e++)if(!c(a[e],d[e]))return!1;return!0;default:return!1}}function h(a){return a.indexOf("/")===-1&&a.indexOf("~")===-1?a:a.replace(/~/g,"~0").replace(/\//g,"~1")}function n(a){for(var b=0,c=k.length;b<c;b++)if(k[b].obj===a)return k[b]}function o(a,b){for(var c=0,d=a.observers.length;c<d;c++)if(a.observers[c].callback===b)return a.observers[c].observer}function p(a,b){for(var c=0,d=a.observers.length;c<d;c++)if(a.observers[c].observer===b)return void a.observers.splice(c,1)}function q(a,b){b.unobserve()}function r(a){return"object"==typeof a?JSON.parse(JSON.stringify(a)):a}function s(a,b){var e,c=[],f=n(a);if(f?e=o(f,b):(f=new l(a),k.push(f)),e)return e;if(e={},f.value=r(a),b){e.callback=b,e.next=null;var g=this.intervals||[100,1e3,1e4,6e4];if(void 0===g.push)throw new OriginalError("jsonpatch.intervals must be an array");var h=0,i=function(){t(e)},j=function(){clearTimeout(e.next),e.next=setTimeout(function(){i(),h=0,e.next=setTimeout(q,g[h++])},0)},q=function(){i(),h==g.length&&(h=g.length-1),e.next=setTimeout(q,g[h++])};"undefined"!=typeof window&&(window.addEventListener?(window.addEventListener("mousedown",j),window.addEventListener("mouseup",j),window.addEventListener("keydown",j)):(document.documentElement.attachEvent("onmousedown",j),document.documentElement.attachEvent("onmouseup",j),document.documentElement.attachEvent("onkeydown",j))),e.next=setTimeout(q,g[h++])}return e.patches=c,e.object=a,e.unobserve=function(){t(e),clearTimeout(e.next),p(f,e),"undefined"!=typeof window&&(window.removeEventListener?(window.removeEventListener("mousedown",j),window.removeEventListener("mouseup",j),window.removeEventListener("keydown",j)):(document.documentElement.detachEvent("onmousedown",j),document.documentElement.detachEvent("onmouseup",j),document.documentElement.detachEvent("onkeydown",j)))},f.observers.push(new m(b,e)),e}function t(a){for(var b,c=0,d=k.length;c<d;c++)if(k[c].obj===a.object){b=k[c];break}u(b.value,a.object,a.patches,""),a.patches.length&&x(b.value,a.patches);var e=a.patches;return e.length>0&&(a.patches=[],a.callback&&a.callback(e)),e}function u(a,c,d,e){for(var f=b(c),g=b(a),i=!1,j=!1,k=g.length-1;k>=0;k--){var l=g[k],m=a[l];if(c.hasOwnProperty(l)){var n=c[l];"object"==typeof m&&null!=m&&"object"==typeof n&&null!=n?u(m,n,d,e+"/"+h(l)):m!=n&&(i=!0,d.push({op:"replace",path:e+"/"+h(l),value:r(n)}))}else d.push({op:"remove",path:e+"/"+h(l),isArray:Array.isArray(c)}),j=!0}if(j||f.length!=g.length)for(var k=0;k<f.length;k++){var l=f[k];a.hasOwnProperty(l)||d.push({op:"add",path:e+"/"+h(l),value:r(c[l])})}}function w(a){for(var d,b=0,c=a.length;b<c;){d=a.charCodeAt(b);{if(!(d>=48&&d<=57))return!1;b++}}return!0}function x(a,b,c){for(var j,k,g=!1,h=0,i=b.length;h<i;){j=b[h],h++;for(var l=j.path||"",m=l.split("/"),n=a,o=1,p=m.length,q=void 0;;){if(k=m[o],c&&void 0===q&&(void 0===n[k]?q=m.slice(0,o).join("/"):o==p-1&&(q=j.path),void 0!==q&&this.validator(j,h-1,a,q)),o++,void 0===k&&o>=p){g=f[j.op].call(j,n,k,a);break}if(v(n)){if("-"===k)k=n.length;else{if(c&&!w(k))throw new z("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",h-1,j.path,j);k=parseInt(k,10)}if(o>=p){if(c&&"add"===j.op&&k>n.length)throw new z("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",h-1,j.path,j);g=e[j.op].call(j,n,k,a);break}}else if(k&&k.indexOf("~")!=-1&&(k=k.replace(/~1/g,"/").replace(/~0/g,"~")),o>=p){g=d[j.op].call(j,n,k,a);break}n=n[k]}}return g}function y(a,b){var c=[];return u(a,b,c,""),c}function A(a){if(void 0===a)return!0;if("array"==typeof a||"object"==typeof a)for(var b in a)if(A(a[b]))return!0;return!1}function B(b,c,e,f){if("object"!=typeof b||null===b||v(b))throw new z("Operation is not an object","OPERATION_NOT_AN_OBJECT",c,b,e);if(!d[b.op])throw new z("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",c,b,e);if("string"!=typeof b.path)throw new z("Operation `path` property is not a string","OPERATION_PATH_INVALID",c,b,e);if(("move"===b.op||"copy"===b.op)&&"string"!=typeof b.from)throw new z("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",c,b,e);if(("add"===b.op||"replace"===b.op||"test"===b.op)&&void 0===b.value)throw new z("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",c,b,e);if(("add"===b.op||"replace"===b.op||"test"===b.op)&&A(b.value))throw new z("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",c,b,e);if(e)if("add"==b.op){var g=b.path.split("/").length,h=f.split("/").length;if(g!==h+1&&g!==h)throw new z("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",c,b,e)}else if("replace"===b.op||"remove"===b.op||"_get"===b.op){if(b.path!==f)throw new z("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",c,b,e)}else if("move"===b.op||"copy"===b.op){var i={op:"_get",path:b.from,value:void 0},j=a.validate([i],e);if(j&&"OPERATION_PATH_UNRESOLVABLE"===j.name)throw new z("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",c,b,e)}}function C(a,b){try{if(!v(a))throw new z("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(b)b=JSON.parse(JSON.stringify(b)),x.call(this,b,a,!0);else for(var c=0;c<a.length;c++)this.validator(a[c],c)}catch(a){if(a instanceof z)return a;throw a}}var b=function(a){if(v(a)){for(var b=new Array(a.length),c=0;c<b.length;c++)b[c]=""+c;return b}if(Object.keys)return Object.keys(a);var b=[];for(var d in a)a.hasOwnProperty(d)&&b.push(d);return b},d={add:function(a,b){return a[b]=this.value,!0},remove:function(a,b){return delete a[b],!0},replace:function(a,b){return a[b]=this.value,!0},move:function(a,b,c){var d={op:"_get",path:this.from};return x(c,[d]),x(c,[{op:"remove",path:this.from,isArray:Array.isArray(this)}]),x(c,[{op:"add",path:this.path,value:d.value}]),!0},copy:function(a,b,c){var d={op:"_get",path:this.from};return x(c,[d]),x(c,[{op:"add",path:this.path,value:d.value}]),!0},test:function(a,b){return c(a[b],this.value)},_get:function(a,b){this.value=a[b]}},e={add:function(a,b){return a.splice(b,0,this.value),!0},remove:function(a,b){return a.splice(b,1),!0},replace:function(a,b){return a[b]=this.value,!0},move:d.move,copy:d.copy,test:d.test,_get:d._get},f={add:function(a){f.remove.call(this,a);for(var b in this.value)this.value.hasOwnProperty(b)&&(a[b]=this.value[b]);return!0},remove:function(a){for(var b in a)a.hasOwnProperty(b)&&d.remove.call(this,a,b);return!0},replace:function(a){return x(a,[{op:"remove",path:this.path,isArray:Array.isArray(this)}]),x(a,[{op:"add",path:this.path,value:this.value}]),!0},move:d.move,copy:d.copy,test:function(a){return JSON.stringify(a)===JSON.stringify(this.value)},_get:function(a){this.value=a}},k=[],l=function(){function a(a){this.observers=[],this.obj=a}return a}(),m=function(){function a(a,b){this.callback=a,this.observer=b}return a}();a.unobserve=q,a.observe=s,a.generate=t;var v;v=Array.isArray?Array.isArray:function(a){return a.push&&"number"==typeof a.length},a.apply=x,a.compare=y;var z=function(a){function b(b,c,d,e,f){a.call(this,b),this.message=b,this.name=c,this.index=d,this.operation=e,this.tree=f}return __extends(b,a),b}(OriginalError);a.JsonPatchError=z,a.Error=z,a.validator=B,a.validate=C}(jsonpatch||(jsonpatch={})),"undefined"!=typeof exports&&(exports.apply=jsonpatch.apply,exports.observe=jsonpatch.observe,exports.unobserve=jsonpatch.unobserve,exports.generate=jsonpatch.generate,exports.compare=jsonpatch.compare,exports.validate=jsonpatch.validate,exports.validator=jsonpatch.validator,exports.JsonPatchError=jsonpatch.JsonPatchError,exports.Error=jsonpatch.Error);